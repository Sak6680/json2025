<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>IMF GDP Per Capita Ranking</title>
    <style>
        body {
            background: #111;
            color: #fff;
            font-family: Arial;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        .country-row {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #333;
            font-size: 18px;
        }
        .rank {
            width: 50px;
        }
        .flag {
            width: 40px;
            height: 25px;
            margin-right: 10px;
        }
        .name {
            width: 200px;
        }
        .value {
            font-weight: bold;
            color: white;
            transition: color 2s;
        }
    </style>
</head>
<body>

<h1>IMF â€“ GDP Per Capita Ranking (NGDPDPC)</h1>

<div id="list"></div>

<script>
async function loadGDP() {
    const url = "https://www.imf.org/external/datamapper/api/v1/NGDPDPC";

    const res = await fetch(url);
    const data = await res.json();

    const gdpData = data.values.NGDPDPC;
    const listDiv = document.getElementById("list");

    let countries = [];

    for (let code in gdpData) {
        let years = Object.keys(gdpData[code]).map(y => parseInt(y));
        let latestYear = Math.max(...years);
        let value = gdpData[code][latestYear];

        if (!isNaN(value)) {
            countries.push({
                code,
                value,
                year: latestYear
            });
        }
    }

    // Sort by highest GDP PC
    countries.sort((a, b) => b.value - a.value);

    let index = 1;

    countries.forEach(c => {
        let row = document.createElement("div");
        row.className = "country-row";

        row.innerHTML = `
            <div class="rank">${index}</div>
            <img class="flag" src="https://flagcdn.com/w40/${c.code.toLowerCase()}.png">
            <div class="name">${c.code}</div>
            <div class="value" id="value_${index}">0</div>
        `;

        listDiv.appendChild(row);

        animateValue(`value_${index}`, 0, c.value, 1500);

        index++;
    });
}

function animateValue(id, start, end, duration) {
    const obj = document.getElementById(id);
    let startTime = null;

    function update(timestamp) {
        if (!startTime) startTime = timestamp;
        let progress = timestamp - startTime;
        let percent = Math.min(progress / duration, 1);
        let value = Math.floor(start + (end - start) * percent);

        obj.textContent = value.toLocaleString();

        // Color change animation
        obj.style.color = end > start ? "lime" : "red";
        if (percent === 1) {
            setTimeout(() => obj.style.color = "white", 2000);
        }

        if (percent < 1) requestAnimationFrame(update);
    }

    requestAnimationFrame(update);
}

loadGDP();
</script>

</body>
</html>
